!function(e){if("object"==typeof exports)module.exports=e();else if("function"==typeof define&&define.amd)define(e);else{var r;"undefined"!=typeof window?r=window:"undefined"!=typeof global?r=global:"undefined"!=typeof self&&(r=self),r.AsyncTask=e()}}(function(){var define,module,exports;return function e(r,n,t){function o(s,a){if(!n[s]){if(!r[s]){var c="function"==typeof require&&require;if(!a&&c)return c(s,!0);if(i)return i(s,!0);throw new Error("Cannot find module '"+s+"'")}var u=n[s]={exports:{}};r[s][0].call(u.exports,function(e){var n=r[s][1][e];return o(n?n:e)},u,u.exports,e,r,n,t)}return n[s].exports}for(var i="function"==typeof require&&require,s=0;s<t.length;s++)o(t[s]);return o}({1:[function(e,r,n){r.exports=e("./src/BackgroundWorker")},{"./src/BackgroundWorker":2}],2:[function(_dereq_,module,exports){(function(__dirname){"use strict";function BackgroundWorker(e){e=e?e:{},this.importScripts=e.importScripts||[],this.definitions=e.definitions||[],this.domain=e.domain||!isNode?location.protocol+"//"+location.host:null,this._spec=e,this._worker=null,this._iframe=null,this._messageId=0,this._messagehandlers={},this._state=BackgroundWorker.CREATED,"function"==typeof e&&this.define("default",e)}function start(e){if(e._isStarted)throw new Error("cannot start allready started BackgroundWorker");return e._isStarted=!0,isNode?setupChildProcess(e):BackgroundWorker.hasWorkerSupport()?setupWebWorker(e):setupIframe(e),stateChange(e,BackgroundWorker.IDLE),e}function postMessage(e,r,n){isNode?e._childProcess.send(r):BackgroundWorker.hasWorkerSupport()?e._worker.postMessage(r):e._iframe.contentWindow.postMessage(r,n)}function setupWebWorker(e){e.blob=new Blob([getWorkerSourcecode(e)],{type:"text/javascript"}),e._worker=new Worker(window.URL.createObjectURL(e.blob)),e._worker.onmessage=function(r){return workerOnMessageHandler(e,r)},e._worker.onerror=function(r){return workerOnErrorHandler(e,r)}}function setupChildProcess(e){e._childProcess=child_process.fork(__dirname+"/nodeworker.js");for(var r=0;r<e.definitions.length;r++)"function"==typeof e.definitions[r].val&&(e.definitions[r].val=e.definitions[r].val.toString()),e._childProcess.send({command:"define",args:[e.definitions[r]],messageId:getUniqueMessageId(e)});e._childProcess.on("message",function(r){childProcessOnMessageHandler(e,r)})}function setupIframe(e){var r,n;e._iframe=document.createElement("iframe"),r=document.createElement("script"),e._iframe.style||(e._iframe.style={}),e._iframe.style.display="none",n="",n+="var domain = '"+e.domain+"';\n",n+="var importScripts = "+JSON.stringify(e.importScripts)+";\n",n+="var definitions = {};\n";for(var t=0;t<e.definitions.length;t++)n+=" definitions['"+e.definitions[t].key+"'] = "+e.definitions[t].val+";\n";n+=";("+function(){function r(e){function r(){var t=importScripts.shift();if(n||!t)return n=!0,e();var o=document.createElement("script");o.onload=function(){r()},document.body.appendChild(o),o.src=t}var n=!1;r()}e.onmessage=function(e){var n=e.data;r(function(){try{var e=definitions[n.command].apply(this,n.args),r={messageId:n.messageId,result:e};postMessage(r,domain)}catch(t){var o={messageId:n.messageId,exception:{type:t.name,message:t.message}};postMessage(o,domain)}})}}.toString()+")();\n",r.innerHTML=n,window.document.body.appendChild(e._iframe),e._iframe.contentWindow.addEventListener("message",function(r){return iframeOnMessageHandler(e,r)}),e._iframe.contentDocument.body.appendChild(r)}function getUniqueMessageId(e){return e._messageId++}function stateChange(e,r){var n;return n=e._state,e._state=r,n!==r}function workerOnMessageHandler(e,r){var n,t;return n=r.data,t=e._messagehandlers[n.messageId],n.exception?t.reject(createExceptionFromMessage(e,n.exception)):void t.resolve(n.result)}function childProcessOnMessageHandler(e,r){var n,t;return n=r,t=e._messagehandlers[n.messageId],n.exception?t.reject(createExceptionFromMessage(e,n.exception)):void t.resolve(n.result)}function iframeOnMessageHandler(e,r){var n,t;return n=r.data,n.command?null:(t=e._messagehandlers[n.messageId],n.exception?t.reject(createExceptionFromMessage(e,n.exception)):void t.resolve(n.result))}function createExceptionFromMessage(self,exception){var type,message;try{type=isNode?eval(exception.type):"function"==typeof global[exception.type]?global[exception.type]:Error}catch(exception){type=Error}return message=exception.message,new type(message)}function memoize(e){var r={},n=r;return function(){return n!==r?n:n=e.apply(null,arguments)}}function workerOnErrorHandler(e,r){var n,t,o,i;r.preventDefault(),n=r.message,t=n.match(/Uncaught\s([a-zA-Z]+)\:(.*)/);try{o="function"==typeof global[t[1]]?global[t[1]]:Error,i="function"==typeof global[t[1]]?t[2]:n}catch(s){o=Error,i=n}t=new o(i),e.emit("exception",t)}function getWorkerSourcecode(e){var r;r="",e.importScripts.length&&(r+="importScripts( '"+e.importScripts.join("','")+"' );\n"),r+=" var definitions = {};";for(var n=0;n<e.definitions.length;n++)r+=" definitions['"+e.definitions[n].key+"'] = "+e.definitions[n].val+";\n";return r+="self.onmessage = function( event ) { try {var data = event.data;var result = definitions[data.command].apply(this, data.args);var out = { messageId: data.messageId, result: result };this.postMessage( out );}catch( exception ) {var message = { messageId: data.messageId, exception: { type: exception.name, message: exception.message } };this.postMessage(message);}};"}var child_process=_dereq_("child_process"),isNode=_dereq_("detect-node");module.exports=BackgroundWorker,BackgroundWorker.hasWorkerSupport=function(){return"undefined"!=typeof window.Worker&&"undefined"!=typeof window.Blob&&"function"==typeof window.URL.createObjectURL},BackgroundWorker.hasStructuredCloneSupport=memoize(function(){try{return window.postMessage(document.createElement("a"),"*"),!0}catch(e){return!e.DATA_CLONE_ERR}}),BackgroundWorker.CREATED={},BackgroundWorker.RUNNING={},BackgroundWorker.IDLE={},BackgroundWorker.TERMINATED={},BackgroundWorker.prototype.define=function(e,r){this.definitions.push({key:e,val:r})},BackgroundWorker.prototype.run=function(e,r){var n,t,o,i,s;if(n=this,"string"!=typeof e&&(e="default",r=Array.prototype.slice.call(n)),n._state===BackgroundWorker.TERMINATED)throw new Error("Cannot call run on a Terminated BackgroundWorker");return n._isStarted||start(n),stateChange(n,BackgroundWorker.RUNNING),t=getUniqueMessageId(n),o={command:e,args:r,messageId:t},i={},s=new Promise(function(e,r){function t(e){return function(){stateChange(n,BackgroundWorker.IDLE),e.apply(n,arguments)}}i.resolve=t(e),i.reject=t(r)}),n._messagehandlers[t]=i,postMessage(n,o,n.domain),s},BackgroundWorker.prototype.terminate=function(){var e;e=this,isNode?e._childProcess&&e._childProcess.kill():BackgroundWorker.hasWorkerSupport()?e._worker&&e._worker.terminate():e._iframe&&e._iframe.remove(),stateChange(e,BackgroundWorker.TERMINATED)},BackgroundWorker.prototype._start=function(){return start(this)};var global="undefined"!=typeof global?global:"undefined"!=typeof window?window:this}).call(this,"/../node_modules/background-worker/src")},{child_process:3,"detect-node":4}],3:[function(e,r,n){},{}],4:[function(e,r,n){(function(e){r.exports=!1;try{r.exports="[object process]"===Object.prototype.toString.call(e.process)}catch(n){}}).call(this,"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],5:[function(e,r,n){(function(e){var n;if(e.crypto&&crypto.getRandomValues){var t=new Uint8Array(16);n=function(){return crypto.getRandomValues(t),t}}if(!n){var o=new Array(16);n=function(){for(var e,r=0;16>r;r++)0===(3&r)&&(e=4294967296*Math.random()),o[r]=e>>>((3&r)<<3)&255;return o}}r.exports=n}).call(this,"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],6:[function(e,r,n){function t(e,r,n){var t=r&&n||0,o=0;for(r=r||[],e.toLowerCase().replace(/[0-9a-f]{2}/g,function(e){16>o&&(r[t+o++]=u[e])});16>o;)r[t+o++]=0;return r}function o(e,r){var n=r||0,t=c;return t[e[n++]]+t[e[n++]]+t[e[n++]]+t[e[n++]]+"-"+t[e[n++]]+t[e[n++]]+"-"+t[e[n++]]+t[e[n++]]+"-"+t[e[n++]]+t[e[n++]]+"-"+t[e[n++]]+t[e[n++]]+t[e[n++]]+t[e[n++]]+t[e[n++]]+t[e[n++]]}function i(e,r,n){var t=r&&n||0,i=r||[];e=e||{};var s=void 0!==e.clockseq?e.clockseq:p,a=void 0!==e.msecs?e.msecs:(new Date).getTime(),c=void 0!==e.nsecs?e.nsecs:m+1,u=a-g+(c-m)/1e4;if(0>u&&void 0===e.clockseq&&(s=s+1&16383),(0>u||a>g)&&void 0===e.nsecs&&(c=0),c>=1e4)throw new Error("uuid.v1(): Can't create more than 10M uuids/sec");g=a,m=c,p=s,a+=122192928e5;var d=(1e4*(268435455&a)+c)%4294967296;i[t++]=d>>>24&255,i[t++]=d>>>16&255,i[t++]=d>>>8&255,i[t++]=255&d;var f=a/4294967296*1e4&268435455;i[t++]=f>>>8&255,i[t++]=255&f,i[t++]=f>>>24&15|16,i[t++]=f>>>16&255,i[t++]=s>>>8|128,i[t++]=255&s;for(var h=e.node||l,k=0;6>k;k++)i[t+k]=h[k];return r?r:o(i)}function s(e,r,n){var t=r&&n||0;"string"==typeof e&&(r="binary"==e?new Array(16):null,e=null),e=e||{};var i=e.random||(e.rng||a)();if(i[6]=15&i[6]|64,i[8]=63&i[8]|128,r)for(var s=0;16>s;s++)r[t+s]=i[s];return r||o(i)}for(var a=e("./rng"),c=[],u={},d=0;256>d;d++)c[d]=(d+256).toString(16).substr(1),u[c[d]]=d;var f=a(),l=[1|f[0],f[1],f[2],f[3],f[4],f[5]],p=16383&(f[6]<<8|f[7]),g=0,m=0,h=s;h.v1=i,h.v4=s,h.parse=t,h.unparse=o,r.exports=h},{"./rng":5}],7:[function(e,r,n){"use strict";function t(e){return e&&e.__esModule?e:{"default":e}}function o(e,r){if(!(e instanceof r))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(n,"__esModule",{value:!0});var i="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol?"symbol":typeof e},s=function(){function e(e,r){for(var n=0;n<r.length;n++){var t=r[n];t.enumerable=t.enumerable||!1,t.configurable=!0,"value"in t&&(t.writable=!0),Object.defineProperty(e,t.key,t)}}return function(r,n,t){return n&&e(r.prototype,n),t&&e(r,t),r}}(),a=e("background-worker"),c=t(a),u=e("uuid"),d=t(u),f=function(){function e(r,n){o(this,e),"object"===("undefined"==typeof r?"undefined":i(r))&&(n=r,r=n.doInBackground),this.options=n||{},this.uuid=d["default"].v4(),this.hasExecuted=!1,this.keepAlive=this.options.keepAlive,this.sharingworker=!1,this.doInBackground=r,"function"!=typeof this.doInBackground&&console.warn("AsyncTask["+this.uuid+"].doInBackground is not function",this),this.options.worker&&(this.sharingworker=!0,this.setWorker(this.options.worker))}return s(e,[{key:"setWorker",value:function(e){return this.worker=e,this.worker.define(this.uuid+"::doInBackground",this.doInBackground.toString()),this.worker}},{key:"execute",value:function(){var e,r,n;if(this.hasExecuted&&!this.keepAlive)throw new Error("Cannot execute a allready executed AsyncTask");return this.worker||this.setWorker(new c["default"]({})),this.hasExecuted=!0,e=this.worker,r=Array.prototype.slice.call(arguments),n=e.run(this.uuid+"::doInBackground",r),this.keepAlive||this.sharingworker||n.then(function(){e.terminate()})["catch"](function(){e.terminate()}),n}}]),e}();n["default"]=f},{"background-worker":1,uuid:6}]},{},[7])(7)});